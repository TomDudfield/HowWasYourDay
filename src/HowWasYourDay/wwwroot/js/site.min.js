angular.module("EmotionApp",[]).controller("EmotionCtrl",function(e,t){function o(e){i.src=window.URL?window.URL.createObjectURL(e):e,i.onerror=function(t){e.stop()},e.onended=n,i.onloadedmetadata=function(e){},setTimeout(function(){a.width=i.videoWidth,a.height=i.videoHeight},50)}function n(){alert("no camera")}navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.getUserMedia,window.URL=window.URL||window.webkitURL;var a=document.getElementById("photo"),i=document.getElementById("webcam");navigator.getUserMedia||alert("no camera"),e.loadDepartments=function(){e.working=!0,e.title="loading departments...",e.departmentSelected=!1,e.department="",e.options=[],e.imageCaptured=!1,e.emotions="",t.get("/api/emotion").success(function(t,o,n,a){e.options=t,e.title="What department?",e.working=!1}).error(function(t,o,n,a){e.title="Oops... something went wrong",e.working=!1})},e.selectDepartment=function(t){e.working=!0,e.departmentSelected=!0,e.department=t,e.title="How was your day?",e.imageCaptured=!1,e.emotions="",navigator.getUserMedia({video:!0},o,n),e.working=!1},e.capture=function(){e.working=!0,e.imageCaptured=!0,e.title="Thanks";var o=a.getContext("2d");o.save(),o.translate(i.videoWidth,0),o.scale(-1,1),o.drawImage(i,0,0),e.imageDataUri=a.toDataURL("image/jpeg",95),o.restore(),t.post("/api/emotion/",{department:e.department,image:e.imageDataUri}).success(function(t,n,i,r){e.emotions=t,Array.prototype.forEach.call(t,function(e){o.beginPath(),o.lineWidth="6",o.strokeStyle="red",o.rect(e.FaceRectangle.Left,e.FaceRectangle.Top,e.FaceRectangle.Width,e.FaceRectangle.Height),o.stroke(),o.fillStyle="red",o.font="30px Arial",o.fillText(e.Scores.TopScoreType,e.FaceRectangle.Left+6,e.FaceRectangle.Top+e.FaceRectangle.Height-6)}),e.imageDataUri=a.toDataURL("image/jpeg",95),console.log(t),e.working=!1}).error(function(t,o,n,a){e.title="Oops... something went wrong",e.working=!1})}});