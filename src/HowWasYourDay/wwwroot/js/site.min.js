navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,angular.module("EmotionApp",[]).controller("EmotionCtrl",function(e,t){e.loadDepartments=function(){e.working=!0,e.title="loading departments...",e.departmentSelected=!1,e.department="",e.options=[],e.imageCaptured=!1,e.emotions="",t.get("/api/emotion").success(function(t,o,n,i){e.options=t,e.title="What department?",e.working=!1}).error(function(t,o,n,i){e.title="Oops... something went wrong",e.working=!1})},e.selectDepartment=function(t){e.working=!0,e.departmentSelected=!0,e.department=t,e.title="How was your day?",e.imageCaptured=!1,e.emotions="",navigator.getUserMedia?navigator.getUserMedia({video:!0},function(e){var t=document.getElementById("webcam");void 0!==t.mozSrcObject?t.mozSrcObject=e:t.src=window.URL&&window.URL.createObjectURL(e)||e,t.onerror=function(t){e.stop()}},function(){alert("no camera")}):alert("no camera"),e.working=!1},e.capture=function(){e.working=!0,e.imageCaptured=!0,e.title="Thanks";var o=document.getElementById("result"),n=document.getElementById("photo"),i=document.getElementById("webcam");n.width=i.videoWidth,n.height=i.videoHeight;var r=n.getContext("2d");r.save(),r.translate(i.videoWidth,0),r.scale(-1,1),r.drawImage(i,0,0),o.src=n.toDataURL("image/jpeg",95),r.restore(),t.post("/api/emotion/",{department:e.department,image:o.src}).success(function(t,i,a,d){e.emotions=t,Array.prototype.forEach.call(t,function(e){r.beginPath(),r.lineWidth="3",r.strokeStyle="red",r.strokeRect(e.Left,e.Top,e.Width,e.Height),r.fillStyle="red",r.font="20px Arial",r.fillText(e.TopScoreType,e.Left+6,e.Top+e.Height-6)}),o.src=n.toDataURL("image/jpeg",95),console.log(t),e.working=!1}).error(function(t,o,n,i){e.title="Oops... something went wrong",e.working=!1})}});