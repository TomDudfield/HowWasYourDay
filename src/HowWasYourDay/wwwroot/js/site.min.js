angular.module("EmotionApp",[]).controller("EmotionCtrl",function(e,t){function a(e){n.src=window.URL?window.URL.createObjectURL(e):e,n.onerror=function(t){e.stop()},e.onended=i,n.onloadedmetadata=function(e){},setTimeout(function(){o.width=n.videoWidth,o.height=n.videoHeight},50)}function i(){alert("no camera")}navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.getUserMedia,window.URL=window.URL||window.webkitURL;var o=document.getElementById("photo"),n=document.getElementById("webcam");navigator.getUserMedia||alert("no camera"),e.loadDepartments=function(){e.working=!0,e.title="loading departments...",e.departmentSelected=!1,e.department="",e.options=[],e.imageCaptured=!1,e.imageDataUri="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",e.emotions="",t.get("/api/emotion").success(function(t,a,i,o){e.options=t,e.title="What department?",e.working=!1}).error(function(t,a,i,o){e.title="Oops... something went wrong",e.working=!1})},e.selectDepartment=function(t){e.working=!0,e.departmentSelected=!0,e.department=t,e.title="How was your day?",e.imageCaptured=!1,e.imageDataUri="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",e.emotions="",navigator.getUserMedia({video:!0},a,i),e.working=!1},e.capture=function(){e.working=!0,e.imageCaptured=!0,e.title="Thanks";var a=o.getContext("2d");a.translate(n.videoWidth,0),a.scale(-1,1),a.drawImage(n,0,0),e.imageDataUri=o.toDataURL("image/jpeg",95),t.post("/api/emotion/",{department:e.department,image:e.imageDataUri}).success(function(t,i,r,g){e.emotions=t,Array.prototype.forEach.call(t,function(e){a.beginPath(),a.lineWidth="6",a.strokeStyle="red",a.rect(n.videoWidth-e.FaceRectangle.Left-e.FaceRectangle.Width,e.FaceRectangle.Top,e.FaceRectangle.Width,e.FaceRectangle.Height),a.stroke()}),e.imageDataUri=o.toDataURL("image/jpeg",95),console.log(t),e.working=!1}).error(function(t,a,i,o){e.title="Oops... something went wrong",e.working=!1})}});