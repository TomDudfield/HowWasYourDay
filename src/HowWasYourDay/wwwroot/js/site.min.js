angular.module("EmotionApp",[]).controller("EmotionCtrl",function(e,t){function o(e){void 0!==r.mozSrcObject?r.mozSrcObject=e:r.src=window.URL&&window.URL.createObjectURL(e)||e,r.onerror=function(t){e.stop()},e.onended=n,r.onloadedmetadata=function(e){},setTimeout(function(){a.width=r.videoWidth,a.height=r.videoHeight},50)}function n(){alert("no camera")}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var a=document.getElementById("photo"),i=document.getElementById("result"),r=document.getElementById("webcam");navigator.getUserMedia?navigator.getUserMedia({video:!0},o,n):alert("no camera"),e.loadDepartments=function(){e.working=!0,e.title="loading departments...",e.departmentSelected=!1,e.department="",e.options=[],e.imageCaptured=!1,e.emotions="",t.get("/api/emotion").success(function(t,o,n,a){e.options=t,e.title="What department?",e.working=!1}).error(function(t,o,n,a){e.title="Oops... something went wrong",e.working=!1})},e.selectDepartment=function(t){e.working=!0,e.departmentSelected=!0,e.department=t,e.title="How was your day?",e.imageCaptured=!1,e.emotions="",navigator.getUserMedia?navigator.getUserMedia({video:!0},o,n):alert("no camera"),e.working=!1},e.capture=function(){e.working=!0,e.imageCaptured=!0,e.title="Thanks";var o=a.getContext("2d");o.save(),o.translate(r.videoWidth,0),o.scale(-1,1),o.drawImage(r,0,0),i.src=a.toDataURL("image/jpeg",95),o.restore(),t.post("/api/emotion/",{department:e.department,image:i.src}).success(function(t,n,r,c){e.emotions=t,Array.prototype.forEach.call(t,function(e){o.beginPath(),o.lineWidth="3",o.strokeStyle="red",o.rect(e.FaceRectangle.Left,e.FaceRectangle.Top,e.FaceRectangle.Width,e.FaceRectangle.Height),o.stroke(),o.fillStyle="red",o.font="20px Arial",o.fillText(e.Scores.TopScoreType,e.FaceRectangle.Left+6,e.FaceRectangle.Top+e.FaceRectangle.Height-6)}),i.src=a.toDataURL("image/jpeg",95),console.log(t),e.working=!1}).error(function(t,o,n,a){e.title="Oops... something went wrong",e.working=!1})}});